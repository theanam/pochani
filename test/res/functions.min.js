function toggleAnnotation(){$(".colors").toggleClass("hiddencolor"),$(".annotate").toggle(),"ontouchstart"in window&&$(".touchnav").toggleClass("shown")}function resizeAnnotate(){$(".annotate").attr({width:$(window).width(),height:$(window).height()}),ctx.lineWidth=3,ctx.lineCap="round",ctx.strokeStyle=strokeColor}function drawingStart(e){e.preventDefault(),mouseDown=!0,$(".toolbox").css("z-index","1000"),e.offsetX?(previousX=e.offsetX,previousY=e.offsetY):(previousY=e.originalEvent.touches[0].clientY,previousX=e.originalEvent.touches[0].clientX)}function drawingEnd(e){e.preventDefault(),mouseDown=!1,$(".toolbox").css("z-index","5000")}function drawingProgress(e){if(e.preventDefault(),mouseDown){ctx.beginPath(),ctx.moveTo(previousX,previousY);var o,n;e.offsetX?(o=e.clientX,n=e.clientY):(o=e.originalEvent.touches[0].clientX,n=e.originalEvent.touches[0].clientY),ctx.lineTo(o,n),ctx.stroke(),previousX=o,previousY=n}}function hideAnnotation(){resizeAnnotate(),$(".colors").removeClass("hiddencolor"),$(".annotate").hide(),$(".touchnav").removeClass("shown")}function turnOnVideo(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia({video:!0,audio:!1},function(e){videoPlaying=!0,theStream=e;var o=window.URL.createObjectURL(e);v.style.display="block",v.src=o,v.play()},function(e){console.log(e)})}function turnOffVideo(){theStream.stop&&(theStream.stop(),thestream=null),v.style.display="none",v.pause(),v.src="",videoPlaying=!1}var slider=$(".slide").pochaSlider({autoPlay:!1,keyboardNavigation:!0});$(".slidecontainer").show(),"ontouchstart"in document&&($(".slide").on("swiperight",slider.next),$(".slide").on("swipeleft",slider.previous),$(".touchnav.right").on("tap",slider.next),$("touchnav.left").on("tap",slider.previous));var strokeColor="#e74c3c",mouseDown=!1,previousX=0,previousY=0,canvas=$(".annotate"),ctx=$(".annotate").get(0).getContext("2d");$(document).on("keydown",function(e){(32==e.keyCode||37==e.keyCode||39==e.keyCode)&&hideAnnotation()}),$(".touchnav").on("tap",hideAnnotation),resizeAnnotate(),$(window).on("resize",resizeAnnotate),canvas.on("mousedown",drawingStart),canvas.on("mouseup",drawingEnd),canvas.on("mouseleave",drawingEnd),canvas.on("mousemove",drawingProgress),"ontouchstart"in document&&(console.log("Registering touch events..."),canvas.on("touchstart",drawingStart),canvas.on("touchend",drawingEnd),canvas.on("touchmove",drawingProgress)),$.each($(".slide"),function(e,o){var n=$(o);n.addClass("childs-"+n.find(">*").length),n.find(">ul,>ol").length>0&&n.addClass("has-list"),1==n.find("img").length&&n.addClass("single-image"),n.find("img").length>1&&n.addClass("multiple-image")}),$(".pin").on("click",function(){$(".toolbox-inner").toggleClass("hide"),$(this).toggleClass("pinned")}),$(".annotation").on("click",function(){toggleAnnotation()}),document.URL.match("file:")?($(".video").hide(),alert("Webcam Video will not work if the file is opened without a server.")):$(".video").on("click",function(){videoPlaying?turnOffVideo():turnOnVideo()}),$(".colors").on("click",".button",function(){ctx.strokeStyle=this.style.backgroundColor,$(".colors .button").removeClass("selected"),$(this).addClass("selected"),strokeColor=this.style.backgroundColor});var videoPlaying=!1,theStream=null,v=$(".webcam").get(0);