function toggleAnnotation(){$(".colors").toggleClass("hiddencolor"),$(".annotate").toggle(),"ontouchstart"in window&&$(".touchnav").toggleClass("shown")}function resizeAnnotate(){$(".annotate").attr({width:$(window).width(),height:$(window).height()}),ctx.lineWidth=3,ctx.lineCap="round",ctx.strokeStyle=strokeColor}function drawingStart(o){o.preventDefault(),mouseDown=!0,$(".toolbox").css("z-index","1000"),o.offsetX?(previousX=o.offsetX,previousY=o.offsetY):(previousY=o.originalEvent.touches[0].clientY,previousX=o.originalEvent.touches[0].clientX)}function drawingEnd(o){o.preventDefault(),mouseDown=!1,$(".toolbox").css("z-index","5000")}function drawingProgress(o){if(o.preventDefault(),mouseDown){ctx.beginPath(),ctx.moveTo(previousX,previousY);var e,n;o.offsetX?(e=o.clientX,n=o.clientY):(e=o.originalEvent.touches[0].clientX,n=o.originalEvent.touches[0].clientY),ctx.lineTo(e,n),ctx.stroke(),previousX=e,previousY=n}}function hideAnnotation(){resizeAnnotate(),$(".colors").removeClass("hiddencolor"),$(".annotate").hide(),$(".touchnav").removeClass("shown")}function turnOnVideo(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,navigator.getUserMedia({video:!0,audio:!1},function(o){videoPlaying=!0,theStream=o;var e=window.URL.createObjectURL(o);v.style.display="block",v.src=e,v.play()},function(o){console.log(o)})}function turnOffVideo(){theStream.stop&&(theStream.stop(),thestream=null),v.style.display="none",v.pause(),v.src="",videoPlaying=!1}var slider=$(".slide").pochaSlider({autoPlay:!1,keyboardNavigation:!0});$(".slidecontainer").show(),"ontouchstart"in document&&($(".slide").on("swiperight",slider.next),$(".slide").on("swipeleft",slider.previous),$(".touchnav.right").on("tap",slider.next),$("touchnav.left").on("tap",slider.previous));var strokeColor="#2c3e50",mouseDown=!1,previousX=0,previousY=0,canvas=$(".annotate"),ctx=$(".annotate").get(0).getContext("2d");$(document).on("keydown",function(o){(32==o.keyCode||37==o.keyCode||39==o.keyCode)&&hideAnnotation()}),$(".touchnav").on("tap",hideAnnotation),resizeAnnotate(),$(window).on("resize",resizeAnnotate),canvas.on("mousedown",drawingStart),canvas.on("mouseup",drawingEnd),canvas.on("mouseleave",drawingEnd),canvas.on("mousemove",drawingProgress),"ontouchstart"in document&&(console.log("Registering touch events..."),canvas.on("touchstart",drawingStart),canvas.on("touchend",drawingEnd),canvas.on("touchmove",drawingProgress)),$.each($(".slide"),function(o,e){var n=$(e);n.addClass("childs-"+n.find(">*").length),n.find(">ul,>ol").length>0&&n.addClass("has-list"),1==n.find("img").length&&n.addClass("single-image"),n.find("img").length>1&&n.addClass("multiple-image")}),$(".pin").on("click",function(){$(".toolbox-inner").toggleClass("hide"),$(this).toggleClass("pinned")}),$(".annotation").on("click",function(){toggleAnnotation()}),$(".video").on("click",function(){videoPlaying?turnOffVideo():turnOnVideo()}),$(".colors").on("click",".button",function(){ctx.strokeStyle=this.style.backgroundColor,$(".colors .button").removeClass("selected"),$(this).addClass("selected"),strokeColor=this.style.backgroundColor});var videoPlaying=!1,theStream=null,v=$(".webcam").get(0);